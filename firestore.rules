rules_version = '2';
service cloud.firestore {
match /databases/{database}/documents {

// User data is private
match /users/{userId} {
  allow read, update: if request.auth.uid == userId;
}

// Orders are private to the user who made them
match /orders/{orderId} {
  allow create: if request.auth.uid != null;
  allow read, list, update: if request.auth.uid == resource.data.userId;
}

// Product rules
match /products/{productId} {
  // --- THIS IS THE FIX ---
  // Anyone can read (get) or list products
  allow get, list: if true;
  // ----------------------

  // Only admins can write (create, update, delete)
  allow create, update, delete: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isAdmin == true;
}


}

}